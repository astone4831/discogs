<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Discogs Explorer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">Discogs Explorer</h1>
    <!-- Release Search -->
    <div class="mb-4">
      <h4>Search by Release ID</h4>
      <div class="input-group mb-2">
        <input type="text" id="releaseId" class="form-control" placeholder="Enter release ID">
        <button onclick="fetchRelease()" class="btn btn-primary">Search</button>
      </div>
    </div>
    <!-- Artist Releases Search -->
    <div class="mb-4">
      <h4>Search Releases by Artist ID</h4>
      <div class="input-group mb-2">
        <input type="text" id="artistId" class="form-control" placeholder="Enter artist ID">
        <button onclick="fetchArtist()" class="btn btn-primary">Search</button>
      </div>
    </div>
    <!-- Download CSV for Release -->
    <div class="mb-4">
      <h4>CSV Output for Release</h4>
      <div class="input-group mb-2">
        <input type="text" id="csvReleaseId" class="form-control" placeholder="Enter release ID">
        <button onclick="downloadCSV()" class="btn btn-success">Download CSV</button>
      </div>
    </div>
    <!-- Download Artist Discography -->
    <div class="mb-4">
      <h4>Download Full Artist Discography</h4>
      <div class="input-group mb-2">
        <input type="text" id="artistCsvId" class="form-control" placeholder="Enter artist ID">
        <button onclick="downloadArtistCSV()" class="btn btn-success">Download Artist Discography</button>
      </div>
    </div>
    <!-- Output -->
    <h5>Results</h5>
    <pre id="output" class="bg-white border rounded p-3" style="max-height: 400px; overflow: auto;"></pre>
  </div>
  <!-- Scripts -->
  <script>
    async function fetchRelease() {
      const id = document.getElementById('releaseId').value;
      const res = await fetch(`/release?id=${id}`);
      const data = await res.json();
      document.getElementById('output').textContent = JSON.stringify(data, null, 2);
    }
    async function fetchArtist() {
      const id = document.getElementById('artistId').value;
      const res = await fetch(`/artist_releases?id=${id}`);
      const data = await res.json();
      document.getElementById('output').textContent = JSON.stringify(data, null, 2);
    }
    function downloadCSV() {
      const id = document.getElementById('csvReleaseId').value;
      if (!id) return;
      window.location.href = `/download_csv?id=${id}`;
    }
    async function downloadArtistCSV() {
      const id = document.getElementById('artistCsvId').value;
      if (!id) {
        alert("Please enter an artist ID");
        return;
      }
      try {
        const res = await fetch(`/download_artist_csv?id=${id}`);
        if (!res.ok) {
          const error = await res.json();
          alert("Error: " + error.error);
          return;
        }
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `artist_${id}.csv`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);
      } catch (err) {
        alert("Unexpected error: " + err.message);
      }
    }
  </script>
</body>
</html>
